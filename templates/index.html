<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Excel Comparison Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">  
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="text-center mb-4">
      <h1 class="fw-bold text-primary"><i class="fas fa-file-excel"></i> Excel Comparison Tool</h1>
      <p class="text-muted">Upload Actual vs Expected Excel files to compare data across multiple sheets.</p>
    </div>

    <form method="POST" enctype="multipart/form-data" id="uploadForm">
      <div id="filePairs" class="d-flex flex-column gap-3">
        <!-- Default Pair -->
        <div class="card shadow-sm p-3 pair-card">
          <div class="row align-items-center">
            <div class="col-md-5 mb-2 mb-md-0">
              <label class="form-label fw-semibold">Actual File:</label>
              <input type="file" name="actual_0" class="form-control" required>
            </div>
            <div class="col-md-5 mb-2 mb-md-0">
              <label class="form-label fw-semibold">Expected File:</label>
              <input type="file" name="expected_0" class="form-control" required>
            </div>
            <div class="col-md-2 text-center">
              <button type="button" class="btn btn-danger remove-btn w-100" disabled>
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center mt-4">
        <button type="button" id="addRow" class="btn btn-outline-primary me-2">
          <i class="fas fa-plus-circle"></i> Add Row
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-check-circle"></i> Compare
        </button>
      </div>
    </form>

    {% if results %}
    <div class="mt-5">
      <h3 class="text-primary mb-3">Comparison Results</h3>
      {% for r in results %}
      <div class="card shadow-sm mb-3">
        <div class="card-header row text-primary fw-semibold align-items-center justify-content-between">
          <div class="col">
            <i class="fas fa-file-contract"></i> {{ r.pair }}
          </div>
          <a  href="{{ url_for('download_file', folder='reports', filename=r.report_file) }}" class="col btn btn-light btn-sm text-primary">
            <i class="fas fa-download"></i> 
          </a>

        </div>
        <div class="card-body">
          {% for sheet in r.results %}
          <details class="mb-2">
            <summary class="fw-semibold">{{ sheet.sheet or 'No Sheet Found' }}</summary>
            <pre class="bg-light p-3 rounded">{{ sheet.message }}</pre>
          </details>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    </div>
    {%else%}
    <div class="mt-5 text-center text-muted">
      <i class="fas fa-info-circle fa-2x mb-2"></i>
      <p>No comparison results to display. Please upload files and click "Compare".</p>
    </div>
    {% endif %}

</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/js/all.min.js" integrity="sha512-6BTOlkauINO65nLhXhthZMtepgJSghyimIalb+crKRPhvhmsCdnIuGcVbR5/aQY2A+260iC1OPy1oCdB6pSSwQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    let pairCount = 1;

    document.getElementById('addRow').addEventListener('click', () => {
      const container = document.getElementById('filePairs');
      const div = document.createElement('div');
      div.classList.add('card', 'shadow-sm', 'p-3', 'pair-card');
      div.innerHTML = `
        <div class="row align-items-center">
          <div class="col-md-5 mb-2 mb-md-0">
            <label class="form-label fw-semibold">Actual File:</label>
            <input type="file" name="actual_${pairCount}" class="form-control" required>
          </div>
          <div class="col-md-5 mb-2 mb-md-0">
            <label class="form-label fw-semibold">Expected File:</label>
            <input type="file" name="expected_${pairCount}" class="form-control" required>
          </div>
          <div class="col-md-2 text-center">
            <button type="button" class="btn btn-danger remove-btn w-100">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>`;
      container.appendChild(div);
      pairCount++;
      updateRemoveButtons();
    });

    function updateRemoveButtons() {
      const removeButtons = document.querySelectorAll('.remove-btn');
      removeButtons.forEach((btn, idx) => {
        btn.disabled = (idx === 0);
        btn.onclick = function() {
          if (!btn.disabled) btn.closest('.pair-card').remove();
        };
      });
    }
    updateRemoveButtons();
  </script>
</body>
</html>
