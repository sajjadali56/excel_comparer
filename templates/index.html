<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Excel Comparison Tool</title>

    <!-- Bootstrap & Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      rel="stylesheet"
    />

    <link
      href="{{ url_for('static', filename='css/styles.css') }}"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="container py-5">
      <!-- Header -->
      <div class="text-center app-header mb-5">
        <img
          src="{{ url_for('static', filename='images/login-banner.png') }}"
          alt="Excel Comparison"
          class="img-fluid"
        />
        <h1 class="fw-bold">
          <i class="fas fa-file-excel me-2"></i>Excel Comparison Tool
        </h1>
        <!-- <p class="lead mb-0">
          Easily compare Actual vs Expected Excel files across multiple sheets.
        </p> -->
        <p class="text-white-50 fs-5 mt-2">
          This tool automatically compares two Excel workbooks — “Actual” and
          “Expected” — across all common sheets. It checks both text and numeric
          columns, highlights statistical differences, and generates a clean,
          downloadable report for each pair.
        </p>
        <hr
          class="border-light opacity-25"
          style="width: 60%; margin: 1.5rem auto"
        />
        <p class="text-light small mb-0">
          Designed for financial model validation, data audits, and
          reconciliation workflows.
        </p>
      </div>

      <!-- Upload Form -->
      <form
        method="POST"
        enctype="multipart/form-data"
        id="uploadForm"
        class="mb-5"
      >
        <div id="filePairs" class="d-flex flex-column gap-3">
          <div class="card pair-card shadow-sm p-3">
            <div class="row align-items-center">
              <div class="col-md-5 mb-3 mb-md-0">
                <label class="form-label fw-semibold text-secondary"
                  >Actual File:</label
                >
                <input
                  type="file"
                  name="actual_0"
                  class="form-control"
                  required
                />
              </div>
              <div class="col-md-5 mb-3 mb-md-0">
                <label class="form-label fw-semibold text-secondary"
                  >Expected File:</label
                >
                <input
                  type="file"
                  name="expected_0"
                  class="form-control"
                  required
                />
              </div>
              <div class="col-md-2 text-center">
                <button
                  type="button"
                  class="btn btn-danger remove-btn w-100"
                  disabled
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-4">
          <button
            type="button"
            id="addRow"
            class="btn btn-outline-primary me-2 px-4"
          >
            <i class="fas fa-plus-circle"></i> Add Pair
          </button>
          <button type="submit" class="btn btn-success px-4">
            <i class="fas fa-check-circle"></i> Compare
          </button>
        </div>
      </form>

      <!-- Results Section -->
      {% if results %}
      <div class="mt-5">
        <h3 class="text-primary mb-3">
          <i class="fas fa-chart-bar me-2"></i>Comparison Results
        </h3>
        {% for r in results %}
        <div class="card shadow-sm mb-4 results-card">
          <div
            class="card-header bg-white d-flex justify-content-between align-items-center fw-semibold text-primary"
          >
            <span><i class="fas fa-file-contract me-2"></i>{{ r.pair }}</span>
            <a
              href="{{ url_for('download_file', folder='reports', filename=r.report_file) }}"
              class="btn btn-sm btn-outline-primary"
            >
              <i class="fas fa-download"></i> Download
            </a>
          </div>
          <div class="card-body">
            {% for sheet in r.results %}
            <details class="mb-3">
              <summary>{{ sheet.sheet or 'Unnamed Sheet' }}</summary>
              <pre class="mt-2">{{ sheet.message }}</pre>
            </details>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="no-results text-center text-muted">
        <i class="fas fa-info-circle fa-2x mb-3"></i>
        <p class="mb-0">
          No comparison results yet. Upload files and click
          <strong>Compare</strong> to begin.
        </p>
      </div>
      {% endif %}

      <footer>
        <p>
          © {{ current_year }} Excel Comparison Tool — Built with ❤️ using Flask
          & Bootstrap 5 By Sajjad Ali
        </p>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/js/all.min.js"></script>
    <script>
      let pairCount = 1;
      document.getElementById("addRow").addEventListener("click", () => {
        const container = document.getElementById("filePairs");
        const div = document.createElement("div");
        div.classList.add("card", "pair-card", "shadow-sm", "p-3");
        div.innerHTML = `
        <div class="row align-items-center">
          <div class="col-md-5 mb-3 mb-md-0">
            <label class="form-label fw-semibold text-secondary">Actual File:</label>
            <input type="file" name="actual_${pairCount}" class="form-control" required>
          </div>
          <div class="col-md-5 mb-3 mb-md-0">
            <label class="form-label fw-semibold text-secondary">Expected File:</label>
            <input type="file" name="expected_${pairCount}" class="form-control" required>
          </div>
          <div class="col-md-2 text-center">
            <button type="button" class="btn btn-danger remove-btn w-100">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>`;
        container.appendChild(div);
        pairCount++;
        updateRemoveButtons();
      });

      function updateRemoveButtons() {
        document.querySelectorAll(".remove-btn").forEach((btn, idx) => {
          btn.disabled = idx === 0;
          btn.onclick = () =>
            !btn.disabled && btn.closest(".pair-card").remove();
        });
      }
      updateRemoveButtons();
    </script>
  </body>
</html>
