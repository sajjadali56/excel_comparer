<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Excel Comparison Tool</title>

    <!-- Bootstrap & Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />

</head>

  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div>
        <div class="logo">
          <img
            src="{{ url_for('static', filename='images/desktop-app-logo.png') }}"
            alt="Logo"
          />
          <h3>Excel Comparison</h3>
        </div>

        <!-- Upload Form -->
        <form
          method="POST"
          enctype="multipart/form-data"
          id="uploadForm"
          class="mt-4"
        >
          <div id="filePairs">
            <div class="card pair-card shadow-sm p-3">
              <div class="mb-3">
                <label class="form-label fw-semibold text-secondary"
                  >Actual File:</label
                >
                <input
                  type="file"
                  name="actual_0"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label fw-semibold text-secondary"
                  >Expected File:</label
                >
                <input
                  type="file"
                  name="expected_0"
                  class="form-control"
                  required
                />
              </div>
              <div class="text-end">
                <button
                  type="button"
                  class="btn btn-danger btn-sm remove-btn"
                  disabled
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="text-center mt-3">
            <button
              type="button"
              id="addRow"
              class="btn btn-outline-primary btn-sm me-2"
            >
              <i class="fas fa-plus-circle"></i> Add Pair
            </button>
            <button type="submit" class="btn btn-success btn-sm">
              <i class="fas fa-check-circle"></i> Compare
            </button>
          </div>
        </form>
      </div>

      <footer>
        © {{ current_year }} — <strong>Sajjad Ali</strong><br />
        Flask + Bootstrap 5
      </footer>
    </div>

    <!-- Main Content -->
    <div class="main">
      <!-- Header -->
      <div class="app-header text-center mb-4">
        <img
          src="{{ url_for('static', filename='images/login-banner.png') }}"
          alt="Excel Comparison Banner"
        />
        <h1><i class="fas fa-file-excel me-2"></i>Excel Comparison Tool</h1>
        <p class="text-white-50 fs-5 mt-3">
          Compare two Excel files — “Actual” and “Expected” — across all common
          sheets. Detect column mismatches, statistical differences, and quickly
          generate detailed reports.
        </p>
      </div>

      <!-- Results -->
      {% if results %}
      <div class="results-section mt-4">
        <h3 class="text-info mb-3">
          <i class="fas fa-chart-bar me-2"></i>Comparison Results
        </h3>
        {% for r in results %}
        <div class="card results-card p-3">
          <div
            class="d-flex justify-content-between align-items-center mb-2 text-info fw-semibold"
          >
            <span><i class="fas fa-file-contract me-2"></i>{{ r.pair }}</span>
            <a
              href="{{ url_for('download_file', folder='reports', filename=r.report_file) }}"
              class="btn btn-sm btn-outline-primary"
            >
              <i class="fas fa-download"></i> Download
            </a>
          </div>

          {% for sheet in r.results %}
          <details class="mb-3">
            <summary>{{ sheet.sheet or 'Unnamed Sheet' }}</summary>
            <pre class="mt-2">{{ sheet.message }}</pre>
          </details>
          {% endfor %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center text-muted mt-5">
        <i class="fas fa-info-circle fa-2x mb-3"></i>
        <p>No results yet — upload files and click <strong>Compare</strong>.</p>
      </div>
      {% endif %}
    </div>

    <!-- JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
    <script>
      let pairCount = 1;
      document.getElementById("addRow").addEventListener("click", () => {
        const container = document.getElementById("filePairs");
        const div = document.createElement("div");
        div.classList.add("card", "pair-card", "shadow-sm", "p-3");
        div.innerHTML = `
          <div class="mb-3">
            <label class="form-label fw-semibold text-secondary">Actual File:</label>
            <input type="file" name="actual_${pairCount}" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold text-secondary">Expected File:</label>
            <input type="file" name="expected_${pairCount}" class="form-control" required>
          </div>
          <div class="text-end">
            <button type="button" class="btn btn-danger btn-sm remove-btn">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>`;
        container.appendChild(div);
        pairCount++;
        updateRemoveButtons();
      });

      function updateRemoveButtons() {
        document.querySelectorAll(".remove-btn").forEach((btn, idx) => {
          btn.disabled = idx === 0;
          btn.onclick = () =>
            !btn.disabled && btn.closest(".pair-card").remove();
        });
      }
      updateRemoveButtons();
    </script>
  </body>
</html>
